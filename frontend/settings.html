<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Param√®tres - Passerelle VHF</title>
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <!-- Sidebar g√©n√©r√©e dynamiquement par sidebar.js -->

        <!-- Main content -->
        <main class="main-content">
            <header class="page-header">
                <h1>Param√®tres syst√®me</h1>
            </header>

            <div class="content">
                <!-- Statut syst√®me -->
                <div class="card">
                    <div class="card-header">
                        <h3>Statut syst√®me</h3>
                    </div>
                    <div class="card-body">
                        <div class="stats-grid" style="grid-template-columns: 1fr 1fr;">
                            <div class="stat-item">
                                <div class="stat-label">üì° R√©ception</div>
                                <div id="runnerStatus" class="stat-value">
                                    <span class="badge badge-secondary">Chargement...</span>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">üìª √âmission</div>
                                <div id="masterStatus" class="stat-value">
                                    <span class="badge badge-secondary">Chargement...</span>
                                </div>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                            <button id="runnerToggleBtn" class="btn btn-secondary" disabled>
                                Chargement...
                            </button>
                            <button id="emissionToggleBtn" class="btn btn-secondary" disabled>
                                Chargement...
                            </button>
                        </div>
                        <p class="text-muted" style="margin-top: 2rem;">
                            <strong>‚ö†Ô∏è Important :</strong> La <strong>R√©ception</strong> r√©cup√®re les mesures m√©t√©o aupr√®s des sources.
                            L'<strong>√âmission</strong> contr√¥le les transmissions radio VHF.
                            Les deux doivent √™tre activ√©s pour que le syst√®me fonctionne.
                        </p>
                    </div>
                </div>

                <!-- Formulaire de configuration -->
                <form id="settingsForm">
                    <!-- Planification -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Planification</h3>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label for="poll_interval_seconds">
                                    Intervalle de polling (secondes)
                                </label>
                                <input type="number" id="poll_interval_seconds" class="form-control" min="10" max="600"
                                    step="10" required>
                                <small class="form-text text-muted">
                                    Fr√©quence de v√©rification des nouvelles mesures aupr√®s des sources (10-600
                                    secondes).
                                </small>
                            </div>

                            <div class="form-group">
                                <label for="inter_announcement_pause_seconds">
                                    Pause entre annonces (secondes)
                                </label>
                                <input type="number" id="inter_announcement_pause_seconds" class="form-control" min="0"
                                    max="60" step="1" required>
                                <small class="form-text text-muted">
                                    Pause entre chaque √©mission pour s√©parer clairement les annonces (0-60 secondes).
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- Configuration PTT -->
                    <div class="card">
                        <div class="card-header">
                            <h3>Configuration PTT (Push-To-Talk)</h3>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label for="ptt_gpio_pin">
                                    Pin GPIO PTT
                                </label>
                                <input type="number" id="ptt_gpio_pin" class="form-control" min="0" max="40"
                                    placeholder="Laisser vide pour mode mock">
                                <small class="form-text text-muted">
                                    Num√©ro de pin GPIO pour contr√¥ler le PTT (Raspberry Pi uniquement). Laisser vide
                                    pour mode mock (d√©veloppement).
                                </small>
                            </div>

                            <div class="form-group">
                                <label for="ptt_active_level">
                                    Niveau actif PTT
                                </label>
                                <select id="ptt_active_level" class="form-control" required>
                                    <option value="0">LOW (0V)</option>
                                    <option value="1">HIGH (3.3V)</option>
                                </select>
                                <small class="form-text text-muted">
                                    Niveau logique pour activer le PTT sur la pin GPIO.
                                </small>
                            </div>

                            <div class="form-group">
                                <label for="ptt_lead_ms">
                                    D√©lai avant audio (millisecondes)
                                </label>
                                <input type="number" id="ptt_lead_ms" class="form-control" min="0" max="2000" step="50"
                                    required>
                                <small class="form-text text-muted">
                                    Temps d'attente apr√®s activation PTT avant de jouer l'audio (0-2000ms). Permet √†
                                    l'√©metteur de se stabiliser.
                                </small>
                            </div>

                            <div class="form-group">
                                <label for="ptt_tail_ms">
                                    D√©lai apr√®s audio (millisecondes)
                                </label>
                                <input type="number" id="ptt_tail_ms" class="form-control" min="0" max="2000" step="50"
                                    required>
                                <small class="form-text text-muted">
                                    Temps d'attente apr√®s la fin de l'audio avant de d√©sactiver PTT (0-2000ms).
                                </small>
                            </div>

                            <div class="form-group">
                                <label>
                                    Timeout de transmission
                                </label>
                                <p id="tx_timeout_display" class="form-control-plaintext">
                                    30 secondes
                                </p>
                                <small class="form-text text-muted">
                                    Timeout maximum pour une transmission (verrouill√© √† 30 secondes pour s√©curit√©). Le
                                    watchdog forcera PTT OFF si d√©pass√©.
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- Boutons d'action -->
                    <div class="card">
                        <div class="card-body">
                            <button type="submit" class="btn btn-primary">
                                Enregistrer les param√®tres
                            </button>
                            <button type="button" class="btn btn-secondary ml-2" onclick="loadSettings()">
                                Annuler
                            </button>
                        </div>
                    </div>
                </form>

                <!-- Aide -->
                <div class="card">
                    <div class="card-header">
                        <h3>üí° Aide</h3>
                    </div>
                    <div class="card-body">
                        <h4>Param√®tres recommand√©s</h4>
                        <ul>
                            <li><strong>Intervalle de polling :</strong> 60 secondes (√©quilibre entre fra√Æcheur des
                                donn√©es et charge r√©seau)</li>
                            <li><strong>Pause entre annonces :</strong> 10 secondes (permet de s√©parer clairement chaque √©mission)
                            </li>
                            <li><strong>PTT lead :</strong> 500ms (standard pour la plupart des √©metteurs VHF)</li>
                            <li><strong>PTT tail :</strong> 500ms (permet coupure propre)</li>
                        </ul>

                        <h4>Mode d√©veloppement</h4>
                        <p>
                            Pour tester sans mat√©riel radio, laisser <strong>Pin GPIO PTT vide</strong>.
                            Le syst√®me utilisera un contr√¥leur PTT mock qui simule les op√©rations sans activer de GPIO.
                        </p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="/static/js/common.js"></script>
    <script src="/static/js/sidebar.js"></script>
    <script src="/static/js/settings.js"></script>
    <script>
        // Initialiser la sidebar
        initSidebar('settings');
    </script>
</body>

</html>